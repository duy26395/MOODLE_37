YUI.add("moodle-course-management",function(e,t){function o(){o.superclass.constructor.apply(this,arguments)}function i(e){o.superclass.constructor.apply(this,[e])}function n(){n.superclass.constructor.apply(this,arguments)}function s(){s.superclass.constructor.apply(this,arguments)}function a(){a.superclass.constructor.apply(this,arguments)}o.NAME="moodle-course-management",o.CSS_PREFIX="management",o.ATTRS={element:{setter:function(t){return"string"==typeof t&&(t=e.one("#"+t)),t}},categorylisting:{value:null},courselisting:{value:null},coursedetails:{value:null},activecategoryid:{value:null},activecourseid:{value:null},categories:{setter:function(t,o){if(e.Lang.isArray(t))return t;var i=this.get(o);return i.push(t),i},value:[]},courses:{validator:function(t){return e.Lang.isArray(t)},value:[]},page:{getter:function(e,t){return null===e&&(e=this.get("element").getData(t),this.set(t,e)),e},value:null},totalpages:{getter:function(e,t){return null===e&&(e=this.get("element").getData(t),this.set(t,e)),e},value:null},totalcourses:{getter:function(e,t){return null===e&&(e=this.get("element").getData(t),this.set(t,e)),e},value:null},ajaxurl:{getter:function(e){return null===e&&(e=M.cfg.wwwroot+"/course/ajax/management.php"),e},value:null},dragdrop:{value:null}},o.prototype={categoriesinit:!1,initializer:function(){e.log("Initialising course category management console","info","moodle-course-management"),this.set("element","coursecat-management");var t=this.get("element"),o=t.one("#category-listing"),n=t.one("#course-listing"),s=null,a=null;o&&(s=o.one('.listitem[data-selected="1"]')),n&&(a=n.one('.listitem[data-selected="1"]')),this.set("categorylisting",o),this.set("courselisting",n),this.set("coursedetails",t.one("#course-detail")),s&&this.set("activecategoryid",s.getData("id")),a&&this.set("activecourseid",a.getData("id")),this.initialiseCategories(o),this.initialiseCourses(),n&&this.set("dragdrop",new i({console:this}))},initialiseCategories:function(t){var o=0;if(!t)return!1;var i=t.one("#menumovecategoriesto");i&&i.setAttribute("disabled",!0);var n=t.one("#menuresortcategoriesby");n&&n.setAttribute("disabled",!0);var a=t.one("#menuresortcoursesby");a&&a.setAttribute("disabled",!0),t.all(".listitem[data-id]").each(function(e){this.set("categories",new s({node:e,console:this})),o++},this),this.categoriesinit?e.log(o+" new categories being managed","info","moodle-course-management"):(this.get("categorylisting").delegate("click",this.handleCategoryDelegation,"a[data-action]",this),this.get("categorylisting").delegate("click",this.handleCategoryDelegation,'input[name="bcat[]"]',this),this.get("categorylisting").delegate("change",this.handleBulkSortByaction,"#menuselectsortby",this),this.categoriesinit=!0,e.log(o+" categories being managed","info","moodle-course-management"))},initialiseCourses:function(){var t=this.getCategoryById(this.get("activecategoryid")),o=this.get("courselisting"),i=0;if(!o)return!1;var n=o.one("#menumovecoursesto");n&&n.setAttribute("disabled",!0),o.all(".listitem[data-id]").each(function(e){this.registerCourse(new a({node:e,console:this,category:t})),i++},this),o.delegate("click",this.handleCourseDelegation,"a[data-action]",this),o.delegate("click",this.handleCourseDelegation,'input[name="bc[]"]',this),e.log(i+" courses being managed","info","moodle-course-management")},registerCourse:function(e){var t=this.get("courses");t.push(e),this.set("courses",t)},handleCourseDelegation:function(t){var o=t.currentTarget,i=o.getData("action"),n=o.ancestor(".listitem").getData("id"),s=this.getCourseById(n);s?s.handle(i,t):e.log("Course with ID "+n+" could not be found for delegation","error","moodle-course-management")},handleCategoryDelegation:function(t){var o=t.currentTarget,i=o.getData("action"),n=o.ancestor(".listitem").getData("id"),s=this.getCategoryById(n);s?s.handle(i,t):e.log("Could not find category to delegate to.","error","moodle-course-management")},isCourseSelected:function(e){var t=!1;if(e&&e.get("checked"))t=!0;else{var o,i=this.get("courses"),n=i.length;for(o=0;o<n;o++)if(i.hasOwnProperty(o)&&i[o].get("node").one('input[name="bc[]"]').get("checked")){t=!0;break}}return t},isCategorySelected:function(e){var t=!1;if(e&&e.get("checked"))t=!0;else{var o,i=this.get("categories"),n=i.length;for(o=0;o<n;o++)if(i.hasOwnProperty(o)&&i[o].get("node").one('input[name="bcat[]"]').get("checked")){t=!0;break}}return t},handleBulkSortByaction:function(e){var t=this.get("categorylisting").one("#menuresortcategoriesby"),o=this.get("categorylisting").one("#menuresortcoursesby"),i=this.get("categorylisting").one('input[name="bulksort"]'),n=e;n?e&&e.currentTarget&&(n=e.currentTarget):n=this.get("categorylisting").one("#menuselectsortby"),n&&(this.get("categories").length<=1||!this.isCategorySelected()&&"selectedcategories"===n.get("options").item(n.get("selectedIndex")).getAttribute("value")?(t&&t.setAttribute("disabled",!0),o&&o.setAttribute("disabled",!0),i&&i.setAttribute("disabled",!0)):(t&&t.removeAttribute("disabled"),o&&o.removeAttribute("disabled"),i&&i.removeAttribute("disabled")))},getCategoryById:function(e){var t,o,i=this.get("categories"),n=i.length;for(t=0;t<n;t++)if(i.hasOwnProperty(t)&&(o=i[t]).get("categoryid")===e)return o;return!1},getCourseById:function(e){var t,o,i=this.get("courses"),n=i.length;for(t=0;t<n;t++)if(i.hasOwnProperty(t)&&(o=i[t]).get("courseid")===e)return o;return!1},removeCourseById:function(e){var t,o=this.get("courses"),i=o.length;for(t=0;t<i;t++)if(o[t].get("courseid")===e){o.splice(t,1);break}},performAjaxAction:function(t,o,i,n){var s=new e.IO;o.action=t,o.ajax="1",o.sesskey=M.cfg.sesskey,null===i&&(i=function(){e.log("'Action '"+t+"' completed","debug","moodle-course-management")}),s.send(this.get("ajaxurl"),{method:"POST",on:{complete:i},context:n,data:o,arguments:o})}},e.extend(o,e.Base,o.prototype),M.course=M.course||{},M.course.management=M.course.management||{},M.course.management.console=null,M.course.management.init=function(e){M.course.management.console=new o(e)},i.NAME="moodle-course-management-dd",i.CSS_PREFIX="management-dd",i.ATTRS={console:{writeOnce:"initOnly"}},i.prototype={goingup:!1,lasty:null,previoussibling:null,initializer:function(){var t=this.get("console").get("element"),o=t.one("#category-listing > .category-listing"),i=t.one("#course-listing > .course-listing"),n=o?o.one("ul.ml-1"):null,s=i?i.one("ul.ml"):null,a=!!i&&i.getData("canmoveoutof"),r=!!o&&o.getData("canmoveoutofcate"),c=a?t:s,g=r?t:n;if(!s)return!1;if(!n)return!1;for(;0===c.get("scrollHeight")&&!c.compareTo(window.document.body);)c=c.get("parentNode"),g=g.get("parentNode");s.all("> li").each(function(e){this.initCourseListing(e,c)},this),s.setData("dd",new e.DD.Drop({node:s})),n.all("> li").each(function(e){this.initCategoryListitem2(e,g)},this),n.setData("dd",new e.DD.Drop({node:n})),a&&n&&n.all("li > div").each(function(e){this.initCategoryListitem(e)},this),e.DD.DDM.on("drag:start",this.dragStart,this),e.DD.DDM.on("drag:end",this.dragEnd,this),e.DD.DDM.on("drag:drag",this.dragDrag,this),e.DD.DDM.on("drop:over",this.dropOver2,this),e.DD.DDM.on("drop:over",this.dropOver,this),e.DD.DDM.on("drop:enter",this.dropEnter,this),e.DD.DDM.on("drop:exit",this.dropExit,this),e.DD.DDM.on("drop:hit",this.dropHit,this)},initCourseListing:function(t,o){t.setData("dd",new e.DD.Drag({node:t,target:{padding:"0 0 0 20"}}).addHandle(".drag-handle").plug(e.Plugin.DDProxy,{moveOnEnd:!1,borderStyle:!1}).plug(e.Plugin.DDConstrained,{constrain2node:o}))},initCategoryListitem:function(t){t.setData("dd",new e.DD.Drop({node:t}))},initCategoryListitem2:function(t,o){t.setData("dd",new e.DD.Drag({node:t,target:{padding:"0 0 0 20"}}).addHandle(".drag-handle").plug(e.Plugin.DDProxy,{moveOnEnd:!1,borderStyle:!1}).plug(e.Plugin.DDConstrained,{constrain2node:o}))},dragStart:function(e){var t=e.target,o=t.get("node"),i=t.get("dragNode");o.addClass("course-being-dragged"),o.test(".listitem-course")?i.addClass("course-being-dragged-proxy").set("innerHTML",o.one("a.coursename").get("innerHTML")):i.addClass("course-being-dragged-proxy").set("innerHTML",o.one("a.categoryname").get("innerHTML")),this.previoussibling=o.get("previousSibling")},dragEnd:function(e){e.target.get("node").removeClass("course-being-dragged"),this.get("console").get("element").all("#category-listing li.highlight").removeClass("highlight")},dragDrag:function(e){var t=e.target.lastXY[1];t<this.lasty?this.goingup=!0:this.goingup=!1,this.lasty=t},dropOver:function(e){var t=e.drag.get("node"),o=e.drop.get("node");if("li"===o.get("tagName").toLowerCase()&&o.hasClass("listitem-course")){if(!this.goingup&&!(o=o.get("nextSibling")))return(o=e.drop.get("node")).get("parentNode").append(t),!1;o.get("parentNode").insertBefore(t,o),e.drop.sizeShim()}},dropOver2:function(e){var t=e.drag.get("node"),o=e.drop.get("node");if("li"===o.get("tagName").toLowerCase()&&o.hasClass("listitem-category")){if(!this.goingup&&!(o=o.get("nextSibling")))return(o=e.drop.get("node")).get("parentNode").append(t),!1;o.get("parentNode").insertBefore(t,o),e.drop.sizeShim()}},dropEnter:function(e){var t=e.drop.get("node");"div"===t.get("tagName").toLowerCase()&&t.ancestor("li.listitem-category").addClass("highlight")},dropExit:function(e){var t=e.drop.get("node");"div"===t.get("tagName").toLowerCase()&&t.ancestor("li.listitem-category").removeClass("highlight")},dropHit:function(t){var o,i,n,s,a,r,c,g,l=t.drag.get("node"),d=t.drop.get("node"),u=null!==d.ancestor(".listitem-category"),m=!u&&d.test(".listitem-course"),h=this.get("console");l.test(".listitem-course")?(n=l.getData("id"),u?(o=d.ancestor(".listitem-category").getData("id"),e.log("Course "+n+" dragged into category "+o),(i=h.getCategoryById(o))&&(s=h.getCourseById(n))&&i.moveCourseTo(s)):m||d.ancestor("#course-listing")?(s=h.getCourseById(n),(a=(c=l.get("previousSibling"))&&c.getData("id")||0)!==(g=this.previoussibling?this.previoussibling.getData("id"):0)&&s.moveAfter(a,g)):e.log("Course dropped over unhandled target.","info","moodle-course-management")):(o=l.getData("id"),d.ancestor("#category-listing"),i=h.getCategoryById(o),(r=(c=l.get("previousSibling"))&&c.getData("id")||0)!==(g=this.previoussibling?this.previoussibling.getData("id"):0)&&i.moveAfter(r,g))}},e.extend(i,e.Base,i.prototype),n.NAME="moodle-course-management-item",n.CSS_PREFIX="management-item",n.ATTRS={node:{},console:{},itemname:{value:"item"}},n.prototype={highlighttimeout:null,checkAjaxResponse:function(t,o,i){if(200!==o.status)return e.log("Error: AJAX response resulted in non 200 status.","error","Item.checkAjaxResponse"),!1;if(null===t||null===i)return e.log("Error: Invalid AJAX response details provided.","error","Item.checkAjaxResponse"),!1;var n=e.JSON.parse(o.responseText);return!1!==n.error&&new M.core.exception(n),!1!==n.outcome&&n},moveup:function(t,o,i){var n,s,a,r,c,g,l;if(!1===this.checkAjaxResponse(t,o,i))return e.log("AJAX request to move "+this.get("itemname")+" up failed by outcome.","warn","moodle-course-management"),!1;(r=(n=this.get("node")).previous(".listitem"))?(r.insert(n,"before"),c=r.one(" > div a.action-moveup"),a=n.one(" > div a.action-movedown"),c&&a||(s=n.one(" > div a.action-moveup"),g=r.one(" > div a.action-movedown"),c||a?a||s.insert(g,"after"):(l=e.Node.create('<a style="visibility:hidden;">&nbsp;</a>'),g.replace(l),s.replace(g),l.replace(s),l.destroy())),(s=n.one(" > div a.action-moveup"))?s.focus():(a=n.one(" > div a.action-movedown"))&&a.focus(),this.updated(!0),e.log("Success: "+this.get("itemname")+" moved up by AJAX.","info","moodle-course-management")):(e.log(this.get("itemname")+" cannot be moved up as its the top item on this page.","info","moodle-course-management"),window.location.reload())},movedown:function(t,o,i){var n,s,a,r,c,g,l;if(!1===this.checkAjaxResponse(t,o,i))return e.log("AJAX request to move "+this.get("itemname")+" down failed by outcome.","warn","moodle-course-management"),!1;(s=(n=this.get("node")).next(".listitem"))?(n.insert(s,"before"),g=s.one(" > div a.action-movedown"),a=n.one(" > div a.action-moveup"),g&&a||(c=s.one(" > div a.action-moveup"),r=n.one(" > div a.action-movedown"),g||a?a||r.insert(c,"before"):(l=e.Node.create('<a style="visibility:hidden;">&nbsp;</a>'),c.replace(l),r.replace(c),l.replace(r),l.destroy())),(r=n.one(" > div a.action-movedown"))?r.focus():(a=n.one(" > div a.action-moveup"))&&a.focus(),this.updated(!0),e.log("Success: "+this.get("itemname")+" moved down by AJAX.","info","moodle-course-management")):(e.log(this.get("itemname")+" cannot be moved down as its the top item on this page.","info","moodle-course-management"),window.location.reload())},show:function(t,o,i){var n;if(!1===this.checkAjaxResponse(t,o,i))return e.log("AJAX request to show "+this.get("itemname")+" by outcome.","warn","moodle-course-management"),!1;this.markVisible(),(n=this.get("node").one("a[data-action=hide]"))&&n.focus(),this.updated(),e.log("Success: "+this.get("itemname")+" made visible by AJAX.","info","moodle-course-management")},markVisible:function(){return this.get("node").setAttribute("data-visible","1"),e.log("Marked "+this.get("itemname")+" as visible","info","moodle-course-management"),!0},hide:function(t,o,i){var n;if(!1===this.checkAjaxResponse(t,o,i))return e.log("AJAX request to hide "+this.get("itemname")+" by outcome.","warn","moodle-course-management"),!1;this.markHidden(),(n=this.get("node").one("a[data-action=show]"))&&n.focus(),this.updated(),e.log("Success: "+this.get("itemname")+" made hidden by AJAX.","info","moodle-course-management")},markHidden:function(){return this.get("node").setAttribute("data-visible","0"),e.log("Marked "+this.get("itemname")+" as hidden","info","moodle-course-management"),!0},updated:function(e){e&&this.highlight()},highlight:function(){var e=this.get("node");e.siblings(".highlight").removeClass("highlight"),e.addClass("highlight"),this.highlighttimeout&&window.clearTimeout(this.highlighttimeout),this.highlighttimeout=window.setTimeout(function(){e.removeClass("highlight")},2500)}},e.extend(n,e.Base,n.prototype),s.NAME="moodle-course-management-category",s.CSS_PREFIX="management-category",s.ATTRS={categoryid:{getter:function(e,t){return null===e&&(e=this.get("node").getData("id"),this.set(t,e)),e},value:null,writeOnce:!0},selected:{getter:function(e,t){return null===e&&(null===(e=this.get("node").getData(t))&&(e=!1),this.set(t,e)),e},value:null},courses:{validator:function(t){return e.Lang.isArray(t)},value:[]}},s.prototype={initializer:function(){this.set("itemname","category")},getName:function(){return this.get("node").one("a.categoryname").get("innerHTML")},registerCourse:function(e){var t=this.get("courses");t.push(e),this.set("courses",t)},handle:function(t,o){var i={categoryid:this.get("categoryid")},n=this.get("console").get("activecategoryid");switch(n&&n!==i.categoryid&&(i.selectedcategory=n),t){case"moveup":o.preventDefault(),this.get("console").performAjaxAction("movecategoryup",i,this.moveup,this);break;case"movedown":o.preventDefault(),this.get("console").performAjaxAction("movecategorydown",i,this.movedown,this);break;case"show":o.preventDefault(),this.get("console").performAjaxAction("showcategory",i,this.show,this);break;case"hide":o.preventDefault(),this.get("console").performAjaxAction("hidecategory",i,this.hide,this);break;case"expand":o.preventDefault(),"0"===this.get("node").getData("expanded")&&(this.get("node").setAttribute("data-expanded","1").setData("expanded","true"),this.get("console").performAjaxAction("getsubcategorieshtml",i,this.loadSubcategories,this)),this.expand();break;case"collapse":o.preventDefault(),this.collapse();break;case"select":var s=this.get("console"),a=s.get("categorylisting").one("#menumovecategoriesto");a&&(s.isCategorySelected(o.currentTarget)&&s.get("categories").length>1?a.removeAttribute("disabled"):a.setAttribute("disabled",!0),s.handleBulkSortByaction());break;default:return e.log("Invalid AJAX action requested of managed category.","warn","moodle-course-management"),!1}},expand:function(){var t=this.get("node"),o=t.one("a[data-action=expand]"),i=t.one("ul[role=group]");t.removeClass("collapsed").setAttribute("aria-expanded","true"),o.setAttribute("data-action","collapse").setAttrs({title:M.util.get_string("collapsecategory","moodle",this.getName())}),require(["core/str","core/templates","core/notification"],function(t,i,n){t.get_string("collapse","core").then(function(e){return i.renderPix("t/switch_minus","core",e)}).then(function(t){return t=e.Node.create(t).addClass("tree-icon").getDOMNode().outerHTML,o.set("innerHTML",t)}).fail(n.exception)}),i&&i.setAttribute("aria-hidden","false"),this.get("console").performAjaxAction("expandcategory",{categoryid:this.get("categoryid")},null,this)},collapse:function(){var t=this.get("node"),o=t.one("a[data-action=collapse]"),i=t.one("ul[role=group]");t.addClass("collapsed").setAttribute("aria-expanded","false"),o.setAttribute("data-action","expand").setAttrs({title:M.util.get_string("expandcategory","moodle",this.getName())}),require(["core/str","core/templates","core/notification"],function(t,i,n){t.get_string("expand","core").then(function(e){return i.renderPix("t/switch_plus","core",e)}).then(function(t){return t=e.Node.create(t).addClass("tree-icon").getDOMNode().outerHTML,o.set("innerHTML",t)}).fail(n.exception)}),i&&i.setAttribute("aria-hidden","true"),this.get("console").performAjaxAction("collapsecategory",{categoryid:this.get("categoryid")},null,this)},loadSubcategories:function(t,o,i){var n,s,a=this.checkAjaxResponse(t,o,i),r=this.get("node"),c=this.get("console");return!1===a?(e.log("AJAX failed to load sub categories for "+this.get("itemname"),"warn","moodle-course-management"),!1):(e.log("AJAX loaded subcategories for "+this.get("itemname"),"info","moodle-course-management"),r.append(a.html),c.initialiseCategories(r),M.core&&M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(r),n=r.one("ul[role=group]"),s=r.one("a[data-action=collapse]"),n&&s&&s.setAttribute("aria-controls",n.generateID()),!0)},moveCourseTo:function(t){var o=this;e.use("moodle-core-notification-confirm",function(){var e=new M.core.confirm({title:M.util.get_string("confirm","moodle"),question:M.util.get_string("confirmcoursemove","moodle",{course:t.getName(),category:o.getName()}),yesLabel:M.util.get_string("move","moodle"),noLabel:M.util.get_string("cancel","moodle")});e.on("complete-yes",function(){e.hide(),e.destroy(),this.get("console").performAjaxAction("movecourseintocategory",{categoryid:this.get("categoryid"),courseid:t.get("courseid")},this.completeMoveCourse,this)},o),e.show()})},completeMoveCourse:function(t,o,i){var n,s,a,r=this.checkAjaxResponse(t,o,i),c=this.get("console");return!1===r?(e.log("AJAX failed to move courses into this category: "+this.get("itemname"),"warn","moodle-course-management"),!1):(s=c.getCourseById(i.courseid))?(e.log("Moved the course ("+s.getName()+") into this category ("+this.getName()+")","debug","moodle-course-management"),this.highlight(),s&&(r.paginationtotals&&(a=c.get("courselisting").one(".listing-pagination-totals"))&&a.set("innerHTML",r.paginationtotals),"undefined"!==r.totalcatcourses&&(a=this.get("node").one(".course-count span"))&&a.set("innerHTML",a.get("innerHTML").replace(/^\d+/,r.totalcatcourses)),void 0!==r.fromcatcoursecount&&(n=c.get("activecategoryid"),(n=c.getCategoryById(n))&&(a=n.get("node").one(".course-count span"))&&a.set("innerHTML",a.get("innerHTML").replace(/^\d+/,r.fromcatcoursecount))),s.remove()),!0):(e.log("Course was moved but the course listing could not be found to reflect this","warn","moodle-course-management"),!1)},show:function(t,o,i){var n,s=this.checkAjaxResponse(t,o,i);if(!1===s)return e.log("AJAX request to show "+this.get("itemname")+" by outcome.","warn","moodle-course-management"),!1;this.markVisible(),(n=this.get("node").one("a[data-action=hide]"))&&n.focus(),s.categoryvisibility&&this.updateChildVisibility(s.categoryvisibility),s.coursevisibility&&this.updateCourseVisiblity(s.coursevisibility),this.updated(),e.log("Success: category made visible by AJAX.","info","moodle-course-management")},hide:function(t,o,i){var n,s=this.checkAjaxResponse(t,o,i);if(!1===s)return e.log("AJAX request to hide "+this.get("itemname")+" by outcome.","warn","moodle-course-management"),!1;this.markHidden(),(n=this.get("node").one("a[data-action=show]"))&&n.focus(),s.categoryvisibility&&this.updateChildVisibility(s.categoryvisibility),s.coursevisibility&&this.updateCourseVisiblity(s.coursevisibility),this.updated(),e.log("Success: "+this.get("itemname")+" made hidden by AJAX.","info","moodle-course-management")},updateCourseVisiblity:function(t){var o,i,n=this.get("console");e.log("Changing categories course visibility","info","moodle-course-management");try{for(o in t)"object"==typeof t[o]&&(i=n.getCourseById(t[o].id))&&("1"===t[o].visible?i.markVisible():i.markHidden())}catch(t){e.log("Error trying to update course visibility: "+t.message,"warn","moodle-course-management")}return this},updateChildVisibility:function(t){var o,i,n=this.get("console");e.log("Changing categories subcategory visibility","info","moodle-course-management");try{for(o in t)"object"==typeof t[o]&&(i=n.getCategoryById(t[o].id))&&("1"===t[o].visible?i.markVisible():i.markHidden())}catch(t){e.log("Error trying to update category visibility: "+t.message,"warn","moodle-course-management")}return this},moveAfter:function(e,t){var o=this.get("console"),i={categoryid:this.get("categoryid"),moveafter:e,previous:t};o.performAjaxAction("movecategoryafter",i,this.moveAfterResponse,this)},moveAfterResponse:function(t,o,i){var n,s=this.checkAjaxResponse(t,o,i),a=this.get("node");if(!1===s)return n=a.ancestor("ul").one("li[data-id="+i.previous+"]"),e.log("AJAX failed to move this course after the requested course","warn","moodle-course-management"),n?n.insertAfter(a,"after"):a.ancestor("ul").one("li").insert(a,"before"),!1;e.log("AJAX successfully moved category ("+this.getName()+")","info","moodle-course-management"),this.highlight()}},e.extend(s,n,s.prototype),a.NAME="moodle-course-management-course",a.CSS_PREFIX="management-course",a.ATTRS={courseid:{},selected:{getter:function(e,t){return null===e&&(e=this.get("node").getData(t),this.set(t,e)),e},value:null},node:{},console:{writeOnce:"initOnly"},category:{writeOnce:"initOnly"}},a.prototype={initializer:function(){var e=this.get("node"),t=this.get("category");this.set("courseid",e.getData("id")),t&&t.registerCourse&&t.registerCourse(this),this.set("itemname","course")},getName:function(){return this.get("node").one("a.coursename").get("innerHTML")},handle:function(t,o){var i=this.get("console"),n={courseid:this.get("courseid")};switch(t){case"moveup":o.halt(),i.performAjaxAction("movecourseup",n,this.moveup,this);break;case"movedown":o.halt(),i.performAjaxAction("movecoursedown",n,this.movedown,this);break;case"show":o.halt(),i.performAjaxAction("showcourse",n,this.show,this);break;case"hide":o.halt(),i.performAjaxAction("hidecourse",n,this.hide,this);break;case"select":var s=this.get("console"),a=s.get("courselisting").one("#menumovecoursesto");a&&(s.isCourseSelected(o.currentTarget)?a.removeAttribute("disabled"):a.setAttribute("disabled",!0));break;default:return e.log("Invalid AJAX action requested of managed course.","warn","moodle-course-management"),!1}},remove:function(){this.get("console").removeCourseById(this.get("courseid")),this.get("node").remove()},moveAfter:function(e,t){var o=this.get("console"),i={courseid:this.get("courseid"),moveafter:e,previous:t};o.performAjaxAction("movecourseafter",i,this.moveAfterResponse,this)},moveAfterResponse:function(t,o,i){var n,s=this.checkAjaxResponse(t,o,i),a=this.get("node");if(!1===s)return n=a.ancestor("ul").one("li[data-id="+i.previous+"]"),e.log("AJAX failed to move this course after the requested course","warn","moodle-course-management"),n?n.insertAfter(a,"after"):a.ancestor("ul").one("li").insert(a,"before"),!1;e.log("AJAX successfully moved course ("+this.getName()+")","info","moodle-course-management"),this.highlight()}},e.extend(a,n,a.prototype)},"@VERSION@",{requires:["base","node","io-base","moodle-core-notification-exception","json-parse","dd-constrain","dd-proxy","dd-drop","dd-delegate","node-event-delegate"]});